---

 

copyright:

  years: 2015，2016

 

---

{:shortdesc: .shortdesc} 
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:screen: .screen}

#生产就绪核对表
上次更新时间：2016 年 9 月 13 日
{: .last-updated}

在应用程序进入生产之前，应确保检查其是否已准备就绪可用于生产，以避免发生中断或错误。
{:shortdesc}

##开发应用程序时要考虑的事项
开发应用程序时，应该确保遵循良好做法。请考虑以下事项：
- 代码库 - 使用修订版控件（例如 Git）将使工作轻松得多，并且能清楚地了解要部署到 Bluemix 的代码库。 
- 依赖关系 - 确保声明所有依赖关系。
- 配置 - 始终在环境变量中存储配置设置。
- 后备服务 - Bluemix 目录包含大量服务（例如 IBM Cloudant），可以基于这些服务来构建应用程序。 
- 构建、发布和运行 - Bluemix 的 buildpack 将处理应用程序的构建（例如，安装 npm 依赖项）、发布和运行。其他任务（如构建资产）可以作为 package.json 文件中的安装后脚本添加。
- 进程 - 进程应该无状态且不共享。Bluemix 需要一个名为 web 的进程，此进程在 Procfile 中进行定义。Bluemix 将在部署上自动创建 Procfile（如果 Procfile 不存在）。创建 Procfile 是可选的。
- 端口绑定 - Bluemix 为您提供了 VCAP_APP_PORT 环境变量。请配置 Web 服务器进程侦听此端口号。然后，Bluemix 会将来自端口 80 和端口 443（用于 HTTPS 请求）的 HTTP 请求路由到此端口。
- 并行 - 通过向 Bluemix 应用程序添加更多进程实例可水平扩展应用程序。分配给每个进程的内存量以及要创建的进程数可以在 manifest.yml 文件中进行定义。
- 一次性 - Bluemix 应用程序应该具有一次性进程，这些进程可以通过 SIGTERM 正常关闭，或在发生底层系统故障时突然关闭。请尽量对应用程序进程采用适毁性设计。这将允许 Bluemix 根据需要停止或启动进程，以便处理崩溃、扩展或其他场景。
- 开发/生产奇偶性校验 - 确保本地开发环境与 Bluemix 上的生产环境良好匹配。为此可以采用多种方法，包括使用 Vagrant 或 Docker。 
- 日志 - Bluemix 具有内置日志记录功能，可通过应用程序仪表板使用该功能。 
- 管理进程 - 应用程序具有任何一次性管理进程吗？管理进程可用于多种任务，例如运行数据库迁移或运行 REPL shell。
- 通过蓝绿部署更新应用程序，以便发生问题时能轻松切换回来。要了解有关蓝绿部署的更多信息，请参阅[蓝绿部署](https://console.chinabluemix.net/docs/manageapps/updapps.html#blue_green){:new_window}。
- 对用户流量使用自动扩展和/或实施调速以避免过载。
- 对具有负载和多个实例的应用程序执行压力测试。
- 测试应用程序所依赖的服务（如数据库）发生故障的情况 - 例如，数据库中断后，应用程序继续正常运行吗？
- 监视面向用户的应用程序可用性，并相应地配置警报。
- 跨多个区域进行部署，并实施区域故障转移。

有关开发云应用程序的更多指导信息，请参阅：[Considerations for Designing and Running an Application in the Cloud](https://docs.cloudfoundry.org/devguide/deploy-apps/prepare-to-deploy.html){:new_window}。

##使应用程序成为云就绪型应用程序
{: #cloud-readyapps}

云就绪型应用程序的设计和构建遵循云平台原则。云就绪型应用程序可以使用云平台提供的各项功能。

您的应用程序如果符合以下所有原则，那么就是云就绪型应用程序，可部署到 {{site.data.keyword.Bluemix_notm}} 中。如果违反了哪个原则，您通常可以通过修改您的应用程序来遵循该原则。

* 不将应用程序直接编码成特定拓扑。

  在非云环境中，应用程序可以使用特定的部署拓扑。但在云应用程序中，应用程序拓扑可能会更改，因为云就绪型应用程序和服务允许进行即时可扩展性更改。可扩展性更改包括动态扩展和手动调整应用程序实例数。

  在构建应用程序时，应尽可能确保应用程序是通用且无状态的，从而避免应用程序受到可扩展性更改的影响。

* 不要认为本地文件系统是永久性的。

  在云上，应用程序实例随时都可能会被移动、删除或复制，因此不要依赖于那些写入到文件系统上的文件。如果应用程序使用本地文件系统来高速缓存频繁使用的信息（包括应用程序日志），那么当关闭应用程序实例并在其他位置或其他 VM 上重新启动该实例时，这些信息会丢失。

  您可以将此类信息存储在 SQL 或 NoSQL 数据库等服务中，而不应将其存储在本地文件系统中。在动态云环境中，还有一点非常重要，那就是用于存储日志的服务必须比生成日志的应用程序实例具有更长的生命周期。

* 不要在应用程序中存储会话状态。

  系统状态是由数据库和共享存储器定义的，而不是由每个单独的运行中应用程序实例定义的。任何的有状态性都会限制应用程序的可扩展性。请尝试将会话状态存储在服务器的集中位置，这样可使会话状态的影响降至最低。

  如果无法完全消除会话状态的影响，请使用应用程序服务器外部的高可用性存储来存储会话状态。这些存储包括 IBM WebSphere Extreme Scale、Redis、Memcached 或外部数据库。

* 不要使用特定基础架构依赖关系。

  此通用原则可以有多种解释。例如，不要认为应用程序所使用的服务具有特定的主机名或 IP 地址分配。在云环境中，服务可能会重新定位或重新生成，因此主机名和 IP 地址也会更改。

  一种可改善此问题的做法是将特定于环境的依赖关系提取到一组属性文件中，但这样做还是不够的。最佳做法是使用外部服务注册表来解析服务端点，或者通过虚拟名称将整个路由功能委派给服务总线或负载均衡器。

* 不要在应用程序中使用基础架构 API。

  如果在应用程序中使用特定的基础架构 API，那么更改基础架构会很困难，因为基础架构 API 可能会引用软件堆栈中的许多不同层。

  可以改用现有开放式源代码或商业产品，并将 PaaS 解决方案保留在 PaaS 层中，以使其不受应用程序代码影响。

* 不要使用模糊协议。

  不要使用需要额外配置才能实现弹性的模糊协议。

  基于标准协议的应用程序可将配置项委派给平台，因而弹性更大。标准协议包括 HTTP、SSL、标准数据库、排队和 Web Service 连接。

* 不要依赖于特定于操作系统的功能。

  如果已经使用了特定于操作系统的功能，那么可以通过兼容性库（例如，Cygwin 和 Mono）来解决此问题。Cygwin 是一种兼容性库，用于在 Windows 环境中提供一组 Linux 工具。Mono 是一种兼容性库，用于在 Linux 中提供 Windows .NET 功能。

  避免特定于操作系统的依赖关系；请改用中间基础架构或服务提供者提供的服务。

* 不要手动安装应用程序。

  在动态云环境中，可能会根据需要频繁安装应用程序。安装过程必须脚本化，且必须可靠；配置数据必须已从脚本进行外部化。

  至少应将应用程序安装脚本化为一组独立于操作系统的统一脚本。尽量确保应用程序安装足够小且可移植，以适应不同的自动化方法。此外，尽可能减少应用程序安装需要的依赖关系。

有关云就绪型应用程序的更多信息，请参阅 [The 12-factor application](http://12factor.net/){:new_window}。

##监视应用程序运行状况
部署了应用程序后，可以通过运行 `cf app APP_NAME` 命令来检查应用程序运行状况。可以查看所有应用程序实例的应用程序状态、内存使用情况和 CPU 使用情况。

此外，运行 `cf events APP_NAME` 命令可查看应用程序崩溃的实例。

最后，可以通过 Bluemix“状态”页面监视应用程序依赖的所有内容。有关更多信息，请参阅 [Viewing Bluemix status](https://console.chinabluemix.net/docs/support/index.html#viewing-bluemix-status){:new_window}。

有关更多故障诊断信息，包括获取应用程序日志，请转至：[https://docs.cloudfoundry.org/devguide/deploy-apps/troubleshoot-app-health.html](https://docs.cloudfoundry.org/devguide/deploy-apps/troubleshoot-app-health.html)。
